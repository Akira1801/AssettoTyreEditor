<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AC Tyre Editor</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState } = React;

        // Lucide React Icons as inline SVG components
        const Upload = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
        );

        const Download = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        const Info = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="16" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
        );

        const TyreGripEditor = () => {
            const [iniContent, setIniContent] = useState('');
            const [parsedTyres, setParsedTyres] = useState([]);
            const [selectedTyre, setSelectedTyre] = useState(null);

            // Baseline values from semislick tyres.ini (for Race/Slick preset ONLY)
            const raceSlickBaseline = {
                DX_REF: 2.6,
                DY_REF: 1.810,
                XMU: 0.27,
                FRICTION_LIMIT_ANGLE: 8.20,
                RELAXATION_LENGTH: 0.07130,
                SPEED_SENSITIVITY: 0.003500,
                ROLLING_RESISTANCE_0: 12,
                FALLOFF_LEVEL: 0.88,
                LS_EXPY: 0.7900,
                LS_EXPX: 0.8600,
                FRICTION_K: 0.04519,
                ROLLING_K: 0.11,
                SURFACE_TRANSFER: 0.0200,
                GRAIN_GAIN: 0.40,
                BLISTER_GAIN: 0.4,
            };

            const presets = {
                stock: {
                    name: 'Stock/Original',
                    description: 'Multiply by 0.5x - Standard road tyres',
                    isMultiplier: true,
                    multipliers: {
                        DX_REF: 0.50,
                        DY_REF: 0.50,
                        XMU: 0.85,
                        FRICTION_LIMIT_ANGLE: 0.61,
                        RELAXATION_LENGTH: 2.0,
                        SPEED_SENSITIVITY: 2.0,
                        ROLLING_RESISTANCE_0: 1.5,
                        FALLOFF_LEVEL: 0.80,
                        LS_EXPY: 0.76,
                        LS_EXPX: 0.70,
                        FRICTION_K: 1.5,
                        ROLLING_K: 1.5,
                        SURFACE_TRANSFER: 0.75,
                        GRAIN_GAIN: 1.5,
                        BLISTER_GAIN: 1.5,
                    }
                },
                street: {
                    name: 'Street Performance',
                    description: 'Multiply by 0.69x - High-performance street',
                    isMultiplier: true,
                    multipliers: {
                        DX_REF: 0.69,
                        DY_REF: 0.69,
                        XMU: 0.93,
                        FRICTION_LIMIT_ANGLE: 0.78,
                        RELAXATION_LENGTH: 1.4,
                        SPEED_SENSITIVITY: 1.4,
                        ROLLING_RESISTANCE_0: 1.25,
                        FALLOFF_LEVEL: 0.88,
                        LS_EXPY: 0.87,
                        LS_EXPX: 0.84,
                        FRICTION_K: 1.2,
                        ROLLING_K: 1.2,
                        SURFACE_TRANSFER: 0.85,
                        GRAIN_GAIN: 1.25,
                        BLISTER_GAIN: 1.25,
                    }
                },
                sport: {
                    name: 'Sport/Track',
                    description: 'Multiply by 0.85x - Track-focused semi-slick',
                    isMultiplier: true,
                    multipliers: {
                        DX_REF: 0.85,
                        DY_REF: 0.85,
                        XMU: 0.96,
                        FRICTION_LIMIT_ANGLE: 0.90,
                        RELAXATION_LENGTH: 1.1,
                        SPEED_SENSITIVITY: 1.1,
                        ROLLING_RESISTANCE_0: 1.08,
                        FALLOFF_LEVEL: 0.95,
                        LS_EXPY: 0.94,
                        LS_EXPX: 0.93,
                        FRICTION_K: 1.08,
                        ROLLING_K: 1.08,
                        SURFACE_TRANSFER: 0.93,
                        GRAIN_GAIN: 1.1,
                        BLISTER_GAIN: 1.1,
                    }
                },
                race: {
                    name: 'Race/Slick (Baseline)',
                    description: 'Set to exact semislick values',
                    isMultiplier: false,
                    absoluteValues: raceSlickBaseline
                },
                arcade: {
                    name: 'Arcade/Maximum',
                    description: 'Multiply by 1.35x - Unrealistic mega-grip',
                    isMultiplier: true,
                    multipliers: {
                        DX_REF: 1.35,
                        DY_REF: 1.35,
                        XMU: 1.15,
                        FRICTION_LIMIT_ANGLE: 1.34,
                        RELAXATION_LENGTH: 0.5,
                        SPEED_SENSITIVITY: 0.5,
                        ROLLING_RESISTANCE_0: 0.67,
                        FALLOFF_LEVEL: 1.02,
                        LS_EXPY: 1.14,
                        LS_EXPX: 1.16,
                        FRICTION_K: 0.66,
                        ROLLING_K: 0.73,
                        SURFACE_TRANSFER: 1.5,
                        GRAIN_GAIN: 0.5,
                        BLISTER_GAIN: 0.5,
                    }
                }
            };

            const parameterInfo = {
                grip: {
                    DX_REF: { name: 'Longitudinal Grip', desc: 'Forward/backward grip (acceleration/braking)', unit: 'multiplier' },
                    DY_REF: { name: 'Lateral Grip', desc: 'Sideways grip (cornering)', unit: 'multiplier' },
                    XMU: { name: 'Friction Coefficient', desc: 'Base friction multiplier', unit: 'coefficient' },
                    FRICTION_LIMIT_ANGLE: { name: 'Slip Angle Limit', desc: 'Max angle before grip loss', unit: 'degrees' },
                    LS_EXPY: { name: 'Lateral Load Sensitivity', desc: 'How grip builds with load', unit: 'exponent' },
                    LS_EXPX: { name: 'Longitudinal Load Sensitivity', desc: 'How forward grip builds', unit: 'exponent' },
                    FALLOFF_LEVEL: { name: 'Grip Falloff Level', desc: 'Remaining grip at extreme slip', unit: '0-1' },
                },
                response: {
                    RELAXATION_LENGTH: { name: 'Response Speed', desc: 'How fast tire reacts to input', unit: 'meters' },
                    SPEED_SENSITIVITY: { name: 'Speed Sensitivity', desc: 'Grip change with speed', unit: 'coefficient' },
                    ROLLING_RESISTANCE_0: { name: 'Rolling Resistance', desc: 'Base resistance to rolling', unit: 'N' },
                },
                thermal: {
                    FRICTION_K: { name: 'Friction Heat', desc: 'Heat from sliding/friction', unit: 'coefficient' },
                    ROLLING_K: { name: 'Rolling Heat', desc: 'Heat from rolling resistance', unit: 'coefficient' },
                    SURFACE_TRANSFER: { name: 'Surface Cooling', desc: 'Heat dissipation to air', unit: 'coefficient' },
                    GRAIN_GAIN: { name: 'Graining Damage', desc: 'Tire surface degradation', unit: 'rate' },
                    BLISTER_GAIN: { name: 'Blister Damage', desc: 'Overheating damage', unit: 'rate' },
                }
            };

            const parseINI = (content) => {
                const lines = content.split('\n');
                const tyres = [];
                let currentSection = null;
                let currentData = {};

                lines.forEach(line => {
                    const trimmed = line.trim();
                    
                    if (trimmed.startsWith('[') && trimmed.endsWith(']')) {
                        if (currentSection && Object.keys(currentData).length > 0) {
                            tyres.push({ section: currentSection, data: { ...currentData } });
                        }
                        currentSection = trimmed.slice(1, -1);
                        currentData = {};
                    }
                    else if (trimmed.includes('=') && !trimmed.startsWith(';')) {
                        const [key, ...valueParts] = trimmed.split('=');
                        const value = valueParts.join('=').trim();
                        currentData[key.trim()] = value;
                    }
                });

                if (currentSection && Object.keys(currentData).length > 0) {
                    tyres.push({ section: currentSection, data: { ...currentData } });
                }

                const tyreSections = tyres.filter(t => 
                    t.section.includes('FRONT') || 
                    t.section.includes('REAR') || 
                    t.section.includes('THERMAL')
                );

                return tyreSections;
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const content = event.target.result;
                        setIniContent(content);
                        const parsed = parseINI(content);
                        setParsedTyres(parsed);
                        if (parsed.length > 0) {
                            setSelectedTyre(0);
                        }
                    };
                    reader.readAsText(file);
                }
            };

            const handlePaste = (e) => {
                const content = e.target.value;
                setIniContent(content);
                const parsed = parseINI(content);
                setParsedTyres(parsed);
                if (parsed.length > 0) {
                    setSelectedTyre(0);
                }
            };

            const updateValue = (key, value) => {
                const updated = [...parsedTyres];
                updated[selectedTyre].data[key] = value;
                setParsedTyres(updated);
            };

            const applyPreset = (presetKey) => {
                if (selectedTyre === null) return;
                
                const preset = presets[presetKey];
                const updated = [...parsedTyres];
                const currentData = updated[selectedTyre].data;
                
                if (preset.isMultiplier) {
                    // Multiply current values by the multipliers
                    Object.keys(preset.multipliers).forEach(key => {
                        if (currentData[key] !== undefined) {
                            const currentValue = parseFloat(currentData[key]);
                            if (!isNaN(currentValue)) {
                                const newValue = currentValue * preset.multipliers[key];
                                currentData[key] = newValue.toFixed(6);
                            }
                        }
                    });
                } else {
                    // Set absolute values (Race/Slick only)
                    Object.keys(preset.absoluteValues).forEach(key => {
                        if (currentData[key] !== undefined) {
                            currentData[key] = preset.absoluteValues[key].toFixed(6);
                        }
                    });
                }
                
                setParsedTyres(updated);
            };

            const exportINI = () => {
                let output = iniContent.split('\n');
                
                parsedTyres.forEach(tyre => {
                    const sectionIndex = output.findIndex(line => line.trim() === `[${tyre.section}]`);
                    if (sectionIndex !== -1) {
                        let i = sectionIndex + 1;
                        while (i < output.length && !output[i].trim().startsWith('[')) {
                            const line = output[i].trim();
                            if (line.includes('=') && !line.startsWith(';')) {
                                const key = line.split('=')[0].trim();
                                if (tyre.data[key] !== undefined) {
                                    output[i] = `${key}=${tyre.data[key]}`;
                                }
                            }
                            i++;
                        }
                    }
                });
                
                const blob = new Blob([output.join('\n')], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'tyres_modified.ini';
                a.click();
                URL.revokeObjectURL(url);
            };

            const renderParameter = (category, key, info) => {
                if (selectedTyre === null) return null;
                const currentData = parsedTyres[selectedTyre].data;
                const value = currentData[key];
                
                if (value === undefined) return null;

                return (
                    <div key={key} className="mb-4 p-3 bg-gray-50 rounded-lg">
                        <div className="flex items-start justify-between mb-2">
                            <div className="flex-1">
                                <label className="font-medium text-gray-700 text-sm">{info.name}</label>
                                <p className="text-xs text-gray-500 mt-1">{info.desc}</p>
                            </div>
                            <span className="text-xs text-gray-400 ml-2">{info.unit}</span>
                        </div>
                        <div className="flex items-center gap-2">
                            <input
                                type="number"
                                step="0.000001"
                                value={value}
                                onChange={(e) => updateValue(key, e.target.value)}
                                className="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            />
                            <code className="text-xs bg-gray-200 px-2 py-1 rounded">{key}</code>
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-gray-900 p-6">
                    <div className="max-w-7xl mx-auto">
                        <div className="bg-white rounded-xl shadow-2xl overflow-hidden">
                            <div className="bg-gradient-to-r from-blue-600 to-blue-800 p-6 text-white">
                                <h1 className="text-3xl font-bold mb-2">Assetto Corsa Tyre Grip Editor</h1>
                                <p className="text-blue-100">Easily modify tire grip and thermal parameters</p>
                            </div>

                            <div className="p-6">
                                <div className="mb-6">
                                    <div className="flex gap-4 mb-4">
                                        <label className="flex-1 cursor-pointer">
                                            <div className="flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                                                <Upload size={20} />
                                                <span>Upload tyres.ini</span>
                                            </div>
                                            <input
                                                type="file"
                                                accept=".ini"
                                                onChange={handleFileUpload}
                                                className="hidden"
                                            />
                                        </label>
                                        {parsedTyres.length > 0 && (
                                            <button
                                                onClick={exportINI}
                                                className="flex items-center gap-2 px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition"
                                            >
                                                <Download size={20} />
                                                <span>Export Modified INI</span>
                                            </button>
                                        )}
                                    </div>

                                    <textarea
                                        value={iniContent}
                                        onChange={handlePaste}
                                        placeholder="Or paste your tyres.ini content here..."
                                        className="w-full h-32 px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none font-mono text-sm"
                                    />
                                </div>

                                {parsedTyres.length > 0 && (
                                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                        <div className="lg:col-span-1">
                                            <div className="bg-gray-50 rounded-lg p-4">
                                                <h3 className="font-bold text-lg mb-4 text-gray-800">Tire Sections</h3>
                                                <div className="space-y-2 max-h-96 overflow-y-auto">
                                                    {parsedTyres.map((tyre, idx) => (
                                                        <button
                                                            key={idx}
                                                            onClick={() => setSelectedTyre(idx)}
                                                            className={`w-full text-left px-4 py-3 rounded-lg transition ${
                                                                selectedTyre === idx
                                                                    ? 'bg-blue-600 text-white shadow-lg'
                                                                    : 'bg-white hover:bg-gray-100 text-gray-700'
                                                            }`}
                                                        >
                                                            <div className="font-medium">{tyre.section}</div>
                                                            <div className={`text-xs mt-1 ${selectedTyre === idx ? 'text-blue-100' : 'text-gray-500'}`}>
                                                                {Object.keys(tyre.data).length} parameters
                                                            </div>
                                                        </button>
                                                    ))}
                                                </div>

                                                <div className="mt-6 pt-6 border-t border-gray-200">
                                                    <h3 className="font-bold text-sm mb-3 text-gray-800">Quick Presets</h3>
                                                    <div className="space-y-2">
                                                        {Object.entries(presets).map(([key, preset]) => (
                                                            <button
                                                                key={key}
                                                                onClick={() => applyPreset(key)}
                                                                className={`w-full text-left px-3 py-2 border border-gray-200 rounded-lg transition text-sm ${
                                                                    preset.isMultiplier 
                                                                        ? 'bg-white hover:bg-blue-50' 
                                                                        : 'bg-yellow-50 hover:bg-yellow-100 border-yellow-300'
                                                                }`}
                                                            >
                                                                <div className="font-medium text-gray-700">{preset.name}</div>
                                                                <div className="text-xs text-gray-500">{preset.description}</div>
                                                            </button>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="lg:col-span-2">
                                            {selectedTyre !== null && (
                                                <div className="bg-white rounded-lg border border-gray-200">
                                                    <div className="bg-gradient-to-r from-gray-50 to-gray-100 p-4 border-b border-gray-200">
                                                        <h2 className="text-xl font-bold text-gray-800">
                                                            {parsedTyres[selectedTyre].section}
                                                        </h2>
                                                    </div>

                                                    <div className="p-6 max-h-[600px] overflow-y-auto">
                                                        <div className="mb-8">
                                                            <div className="flex items-center gap-2 mb-4">
                                                                <div className="w-1 h-6 bg-blue-600 rounded-full"></div>
                                                                <h3 className="text-lg font-bold text-gray-800">Grip Parameters</h3>
                                                            </div>
                                                            {Object.entries(parameterInfo.grip).map(([key, info]) =>
                                                                renderParameter('grip', key, info)
                                                            )}
                                                        </div>

                                                        <div className="mb-8">
                                                            <div className="flex items-center gap-2 mb-4">
                                                                <div className="w-1 h-6 bg-green-600 rounded-full"></div>
                                                                <h3 className="text-lg font-bold text-gray-800">Response Parameters</h3>
                                                            </div>
                                                            {Object.entries(parameterInfo.response).map(([key, info]) =>
                                                                renderParameter('response', key, info)
                                                            )}
                                                        </div>

                                                        <div className="mb-4">
                                                            <div className="flex items-center gap-2 mb-4">
                                                                <div className="w-1 h-6 bg-red-600 rounded-full"></div>
                                                                <h3 className="text-lg font-bold text-gray-800">Thermal Parameters</h3>
                                                            </div>
                                                            {Object.entries(parameterInfo.thermal).map(([key, info]) =>
                                                                renderParameter('thermal', key, info)
                                                            )}
                                                        </div>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                )}

                                {parsedTyres.length === 0 && (
                                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-6 mt-6">
                                        <div className="flex items-start gap-3">
                                            <Info size={24} className="text-blue-600 flex-shrink-0 mt-1" />
                                            <div>
                                                <h3 className="font-bold text-blue-900 mb-2">How to use:</h3>
                                                <ol className="list-decimal list-inside space-y-1 text-blue-800 text-sm">
                                                    <li>Upload your tyres.ini file or paste the content</li>
                                                    <li>Select a tire section from the sidebar</li>
                                                    <li>Use Race/Slick to set exact baseline values, or other presets to multiply current values</li>
                                                    <li>Manually adjust parameters if needed</li>
                                                    <li>Export the modified INI file</li>
                                                    <li>Replace the original tyres.ini in your car mod folder</li>
                                                </ol>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TyreGripEditor />);
    </script>
</body>
</html>